---
title: "Exploratoray Analysis"
date: today
output: html_document
---

# Setup

```{r}
#load needed packages. make sure they are installed.
library(here) #for data loading/saving
library(dplyr)
library(skimr)
library(ggplot2)
library(forcats)
library(plyr)
library(ggthemes)
```


Load the data.

```{r}
#Path to data. Note the use of the here() package and not absolute paths
data_location <- here::here("data","processed-data","processeddata.rds")
#load data
mydata <- readRDS(data_location)
mydata$label = fct_recode(mydata$label, "No" = "0", "Yes" = "1")
```


# Data exploration through tables

Showing a bit of code to produce and save a summary table.


```{r}
summary_df = skimr::skim(mydata)
print(summary_df)
# save to file
summarytable_file = here::here("results", "tables", "summarytable.rds")
saveRDS(summary_df, file = summarytable_file)
```

We are saving the results for each of the plots to the `results` folder. 

# Data exploration through figures

Density plots for the continuous outcomes -- email body length first. We'll utilize the `ggplot2` visualization package, which offers a `geom_density` shape that is well suited to visualizing the distributions of multiple groups in the same plot. In our case that will be both spam and legitimate emails. 

```{r}
p1 <- mydata %>% ggplot(aes(x = bodylength, fill = label)) +
      geom_density(position = "dodge", alpha = 0.5) +
      xlim(0,7500) + xlab("Length") + ylab("Density") +
      labs(title = "Body Distribution", caption = "x-axis limited to a maximum of 7,500", fill = "Spam") +
      theme_tufte() +
      theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
plot(p1)
figure_file = here::here("results", "figures","bodylength-distribution.png")
ggsave(filename = figure_file, plot=p1) 
```

And we'll produce the same visualization for subject line length.

```{r}
p2 <- mydata %>% ggplot(aes(x=subjectlength, fill = label)) +
      geom_density(position = "dodge", alpha = 0.5) +
      xlim(0,150) + xlab("Length") + ylab("Density") +
      labs(title = "Subject Line Distribution", caption = "x-axis limited to a maximum of 150", fill = "Spam") +
      theme_tufte() +
      theme(plot.title = element_text(hjust = 0.5), legend.position = "bottom")
plot(p2)
figure_file = here::here("results", "figures","subjectlength-distribution.png")
ggsave(filename = figure_file, plot=p2) 
```
Now the most common sender domains for spam emails. We'll continue to utilize `ggplot2`, this time with the `geom_col` shape in order to produce a bar chart of counts. 

```{r}
p3 <- mydata[which(mydata$label == "Yes" & !(mydata$senderdomain == "")),] %>%
      dplyr::count(senderdomain) %>%
      arrange(desc(n)) %>%
      head(25) %>%
      ggplot(aes(x = n, y = fct_reorder(senderdomain, n))) +
      geom_col(fill = "turquoise3", colour = "black", alpha = 0.65) +
      labs(title = "Spam Emails by Sender Domain") +
      ylab("") + xlab("Count") +
      theme_tufte() +
      theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5), legend.position = "none")
plot(p3)
figure_file = here::here("results", "figures", "spam-by-domain.png")
ggsave(filename = figure_file, plot=p3) 
```
And similarly we'll produce a bar chart for legitimate emails. 

```{r}
p3 <- mydata[which(mydata$label == "No" & !(mydata$senderdomain == "")),] %>%
      dplyr::count(senderdomain) %>%
      arrange(desc(n)) %>%
      head(25) %>%
      ggplot(aes(x = n, y = fct_reorder(senderdomain, n))) +
      geom_col(fill = "red3", colour = "black", alpha = 0.35) +
      labs(title = "Legit Emails by Sender Domain") +
      ylab("") + xlab("Count") +
      theme_tufte() +
      theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5), legend.position = "none")
plot(p3)
figure_file = here::here("results", "figures", "legit-by-domain.png")
ggsave(filename = figure_file, plot=p3) 
```

# Notes

For your own explorations, tables and figures can be "quick and dirty". As long as you can see what's going on, there is no need to polish them. That's in contrast to figures you'll produce for your final products (paper, report, presentation, website, etc.). Those should look as nice, polished and easy to understand as possible.


